#name: Ktools Release
#
on:
  # ONLY USE PUSH FOR TESTING --- delete this
  push:
  workflow_dispatch:
    inputs:
      build_branch:
        description: 'Branch of build script repo - https://github.com/OasisLMF/build'
        required: true
        default: master
      RELEASE_TAG:
        description: 'Release tag to publish ktools as'
        required: true
        default: ''
      PREV_RELEASE_TAG:
        description: 'The last release, used for generating the changelog'
        required: true
        default: ''
      PRE_RELEASE:
        description: 'Mark release as pre-release'
        required: true
        default: false
      AUTO_MERGE:
        description: 'Run Git flow, git_merge(source_branch -> master) and then git_merge(master -> develop)'
        required: true
        default: false


env:
  MAIN_BRANCH: "test-master"
  DEVELOP_BRANCH: "test-develop"


jobs:
  build:
    uses: ./.github/workflows/build.yml
    secrets: inherit
    with:
      create_ktools_builder: 'false'


# https://github.com/marketplace/actions/download-workflow-artifact
  create_release:
    runs-on: ubuntu-latest
    steps:

    - name: Checkout
      uses: actions/checkout@v3

    - name: Download Linux binaies 
      uses: actions/download-artifact@v3
      with:
        name: Linux_x86_64

    - name: Download Darwin binaies 
      uses: actions/download-artifact@v3
      with:
        name: Darwin_x86_64
