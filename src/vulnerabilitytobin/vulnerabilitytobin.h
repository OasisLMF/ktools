#ifndef VULNERABILITYTOBIN_H_
#define VULNERABILITYTOBIN_H_

#include <cstdio>
#include <cstring>
#include <vector>

#include "../include/oasis.h"
#include "../include/validate.h"
#include "../validatevulnerability/validatevulnerability.h"


class VulnerabilityToBin : public ValidateVulnerability {
public:
  VulnerabilityToBin(const int maxDamageBinIdx, const char* binFileName,
		     const char* idxFileName, const bool useIndexFile,
		     const bool zip, const bool allIntensityBinsCheck);
  ~VulnerabilityToBin();

  void WriteHeader();
  void ReadVulnerabilityFileNoChecks();

private:
  const int maxDamageBinIdx_;
  const bool zip_;
  FILE *fileOutBin_ = nullptr;
  FILE *fileOutIdx_ = nullptr;
  VulnerabilityIndex vIdx_ = {};   // default original size = 0
  int rowCount_ = 0;
  std::vector<VulnerabilityRow> vulnerabilityRows_;

  void ReadFirstVulnerabilityLine() {
    OASIS_FLOAT totalProbability = 0.0;
    ValidateVulnerability::ReadFirstVulnerabilityLine(totalProbability);
  }

  void WriteBinVulnerabilityFile() override;
  void WriteIdxVulnerabilityFile() override;
};

#endif   // VULNERABILITYTOBIN_H_
